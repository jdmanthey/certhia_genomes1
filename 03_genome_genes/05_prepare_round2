# some of this code modified from https://gist.github.com/darencard/bb1001ac1532dd4225b030cf0cd61ce2

# prepare gff files for round 2 of maker

cd /lustre/scratch/jmanthey/00_certhia_maker/06_certhia_reordered.maker.output 

gff3_merge -n -s -d 06_certhia_reordered_master_datastore_index.log > Certhia_round1.all.maker.noseq.gff

# protein alignments
awk '{ if ($2 == "protein2genome") print $0 }' Certhia_round1.all.maker.noseq.gff > Certhia_round1.all.maker.protein2genome.gff
# repeat alignments
awk '{ if ($2 ~ "repeat") print $0 }' Certhia_round1.all.maker.noseq.gff > Certhia_round1.all.maker.repeats.gff

# move back up to parent directory
cd ..

# copy the original control file with options to save that information and modify the original control file
# for round 2
cp maker_opts.ctl maker_round1_opts.ctl

# rename the maker round 1 output directory
mv -r 06_certhia_reordered.maker.output/ maker_output_round1/

# modify the control file (copied in this directory)

# run maker round 2
mpiexec -n 108 maker
